<!DOCTYPE html>
<html>
<head>
    <title>Galloners Club - Tracking</title>
    <meta charset="UTF-8">
    <style>
        body { margin:0; font-family:Arial; background:#f4f4f4; }
        header { background:#b30000; color:white; padding:15px; text-align:center; }
        .logo { width:100px; display:block; margin:10px auto; }
        .container { max-width:95%; margin:20px auto; background:white; padding:20px; border-radius:10px; box-shadow:0 3px 10px rgba(0,0,0,0.1); }
        table { width:100%; border-collapse:collapse; }
        th, td { padding:8px; border:1px solid #ddd; text-align:center; }
        th { background:#b30000; color:white; }
        button { padding:5px 8px; margin:2px; border:none; border-radius:4px; cursor:pointer; color:white; }
        .edit-btn { background:#1565c0; }
        .delete-btn { background:#c62828; }
        .view-btn { background:#6a1b9a; }
        .top-btn { background:#b30000; }
        .galloner-btn { background:#1e88e5; }
        .bronze-btn { background:#cd7f32; }
        .silver-btn { background:#9e9e9e; }
        .gold-btn { background:#d4af37; color:black; }
        .filter-btn { background:#222; }
    </style>
</head>

<body>

<header>
    <img src="images/logo.png" class="logo">
    <h2>Donor Tracking</h2>
</header>

<div class="container">

<input type="text" id="searchInput" placeholder="Search donor..." onkeyup="searchDonor()" style="margin-bottom:10px; padding:5px;">

<button class="top-btn" onclick="goDashboard()">Return to Dashboard</button>

<br><br>

<table>
<thead>
<tr>
<th>#</th>
<th>Name</th>
<th>Blood Type</th>
<th>Contact</th>
<th>Serial Count</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="donorTable"></tbody>
</table>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyByh0YJ11ZpbRV7EoDoLnqgFxe1r68efPI",
    authDomain: "galloners-club.firebaseapp.com",
    projectId: "galloners-club",
    storageBucket: "galloners-club.firebasestorage.app",
    messagingSenderId: "213049860421",
    appId: "1:213049860421:web:4156aaa52b945f48711e2c",
    measurementId: "G-XYXJH9JNXJ"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let donors = [];

async function loadDonors(){
    donors = [];
    const querySnapshot = await getDocs(collection(db, "donors"));
    querySnapshot.forEach((docSnap)=>{
        donors.push({ id: docSnap.id, ...docSnap.data() });
    });
    renderTable();
}

function renderTable(){
    let table = document.getElementById("donorTable");
    table.innerHTML = "";

    if(donors.length === 0){
        table.innerHTML = `<tr><td colspan="6">No donors found</td></tr>`;
        return;
    }

    donors.forEach((donor,index)=>{
        let serialCount = donor.serials ? donor.serials.length : 0;

        table.innerHTML += `
        <tr>
            <td>${index+1}</td>
            <td>${donor.firstName || ""} ${donor.middleName || ""} ${donor.surname || ""}</td>
            <td>${donor.bloodType || ""} ${donor.rhFactor || ""}</td>
            <td>${donor.contact || ""}</td>
            <td>${serialCount}</td>
            <td>
                <button class="delete-btn" onclick="deleteDonor('${donor.id}')">Delete</button>
            </td>
        </tr>
        `;
    });
}

window.deleteDonor = async function(id){
    await deleteDoc(doc(db, "donors", id));
    loadDonors();
}

window.searchDonor = function(){
    let input = document.getElementById("searchInput").value.toLowerCase();
    let rows = document.querySelectorAll("#donorTable tr");

    rows.forEach(row=>{
        row.style.display = row.innerText.toLowerCase().includes(input) ? "" : "none";
    });
}

window.goDashboard = function(){
    window.location.href="dashboard.html";
}

loadDonors();

</script>

</body>
</html>
