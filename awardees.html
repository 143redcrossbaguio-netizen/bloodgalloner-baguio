<!DOCTYPE html>
<html>
<head>
    <title>Awardees</title>
    <meta charset="UTF-8">

    <style>
        body { margin:0; font-family:Arial; background:#f4f4f4; }
        header { background:#b30000; color:white; padding:15px; text-align:center; }
        .container { max-width:95%; margin:20px auto; background:white; padding:20px; border-radius:10px; box-shadow:0 3px 10px rgba(0,0,0,0.1); }

        h3 { margin-top:30px; color:#b30000; }

        .donor-row {
            display:flex;
            justify-content:space-between;
            align-items:center;
            border-bottom:1px solid #ddd;
            padding:8px 0;
        }

        .btn {
            padding:5px 8px;
            margin-left:5px;
            border:none;
            border-radius:4px;
            cursor:pointer;
            color:white;
        }

        .awarded { background:#2e7d32; }
        .notawarded { background:#c62828; }
        .claimed { background:#1565c0; }
        .unclaimed { background:#6a1b9a; }

        input[type="date"] {
            margin-left:5px;
            padding:3px;
        }

        .top-btn {
            background:#b30000;
            color:white;
            padding:8px 12px;
            border:none;
            border-radius:5px;
            cursor:pointer;
            margin-bottom:15px;
        }

        select {
            padding:5px;
            margin-right:10px;
        }

        .filters {
            margin-bottom:15px;
        }
    </style>
</head>

<body>

<header>
    <h2>Awardees</h2>
</header>

<div class="container">

<button class="top-btn" onclick="goDashboard()">Return to Dashboard</button>

<div class="filters">
    <select id="bloodFilter" onchange="renderAwardees()">
        <option value="">All Blood Types</option>
        <option value="A">A</option>
        <option value="B">B</option>
        <option value="AB">AB</option>
        <option value="O">O</option>
    </select>

    <select id="statusFilter" onchange="renderAwardees()">
        <option value="">All Statuses</option>
        <option value="awarded">Awarded</option>
        <option value="notawarded">Not Awarded</option>
        <option value="claimed">Claimed</option>
        <option value="unclaimed">Unclaimed</option>
    </select>
</div>

<div id="awardContainer"></div>

</div>

<script>

function getDonors(){
    let data = localStorage.getItem("donors");
    if(!data) return [];
    return JSON.parse(data);
}

function getCategoryLimits(){
    let settings = localStorage.getItem("categorySettings");
    if(!settings){
        return { galloner:8, bronze:28, silver:46, gold:70 };
    }
    return JSON.parse(settings);
}

function renderAwardees(){

    let donors = getDonors();
    let limits = getCategoryLimits();
    let container = document.getElementById("awardContainer");
    let bloodFilter = document.getElementById("bloodFilter").value;
    let statusFilter = document.getElementById("statusFilter").value;

    container.innerHTML = "";

    let categories = {
        galloner: limits.galloner,
        bronze: limits.bronze,
        silver: limits.silver,
        gold: limits.gold
    };

    for(let category in categories){

        container.innerHTML += `<h3>${category.toUpperCase()}</h3>`;

        donors.forEach((donor,index)=>{

            let serialCount = donor.serials ? donor.serials.length : 0;

            // Check if donor qualifies for this category
            if(serialCount < categories[category]) return;

            // Blood type filter
            if(bloodFilter && donor.bloodType !== bloodFilter) return;

            // Status filter
            if(statusFilter && (!donor.awardStatus || !donor.awardStatus[statusFilter])) return;

            let fullName = `${donor.firstName || ""} ${donor.middleName || ""} ${donor.surname || ""}`;

            container.innerHTML += `
                <div class="donor-row">
                    <div>${fullName}</div>
                    <div>
                        <button class="btn awarded" onclick="setStatus(${index},'awarded','${category}')">Awarded</button>
                        <button class="btn notawarded" onclick="setStatus(${index},'notawarded','${category}')">Not Awarded</button>
                        <button class="btn claimed" onclick="setStatus(${index},'claimed','${category}')">Claimed</button>
                        <button class="btn unclaimed" onclick="setStatus(${index},'unclaimed','${category}')">Unclaimed</button>
                        <span id="dateArea${index}${category}"></span>
                    </div>
                </div>
            `;
        });
    }
}

function setStatus(index,type,category){

    let donors = getDonors();

    if(!donors[index].awardStatus){
        donors[index].awardStatus = {};
    }

    donors[index].awardStatus[type] = new Date().toISOString().split("T")[0];

    localStorage.setItem("donors", JSON.stringify(donors));

    showDateInline(index,type,category);
    renderAwardees(); // refresh view to apply status filter
}

function showDateInline(index,type,category){
    let dateArea = document.getElementById("dateArea"+index+category);
    if(dateArea){
        dateArea.innerHTML = `<input type="date" value="${new Date().toISOString().split("T")[0]}">`;
    }
}

function goDashboard(){
    window.location.href="dashboard.html";
}

window.onload = function(){
    renderAwardees();
};

</script>

</body>
</html>
