<!DOCTYPE html>
<html>
<head>
    <title>Galloners Club - Donor Entry</title>
    <meta charset="UTF-8">

    <style>
        body { margin:0; font-family:Arial; background:#f4f4f4; }
        header { background:#b30000; color:white; padding:15px; text-align:center; }
        .container { max-width:500px; margin:20px auto; background:white; padding:20px; border-radius:10px; box-shadow:0 3px 10px rgba(0,0,0,0.1); }
        input, select { width:100%; padding:8px; margin-bottom:10px; }
        button { padding:8px; margin-top:5px; background:#b30000; color:white; border:none; border-radius:5px; cursor:pointer; }
        .serial-box { margin-top:10px; }
    </style>
</head>

<body>

<header>
    <h2>Donor Entry</h2>
</header>

<div class="container">

<input type="text" id="firstName" placeholder="First Name">
<input type="text" id="middleName" placeholder="Middle Name">
<input type="text" id="surname" placeholder="Surname">

<select id="bloodType">
    <option value="">Blood Type</option>
    <option value="A">A</option>
    <option value="B">B</option>
    <option value="AB">AB</option>
    <option value="O">O</option>
</select>

<select id="rhFactor">
    <option value="">Rh Factor</option>
    <option value="+">+</option>
    <option value="-">-</option>
</select>

<input type="date" id="birthday">
<input type="text" id="contact" placeholder="Contact Number">

<hr>

<h3>Serial Records</h3>

<input type="text" id="serialInput" placeholder="Serial Number">
<input type="date" id="dateInput">
<button onclick="addSerial()">Add Serial</button>

<div id="serialList" class="serial-box"></div>

<hr>

<button onclick="saveDonor()">Save Donor</button>
<button onclick="window.location.href='dashboard.html'">Return to Dashboard</button>
<button onclick="window.location.href='tracking.html'">Go to Tracking</button>

</div>

<!-- ðŸ”¥ FIREBASE + CLOUD SAVE INTEGRATED -->
<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyByh0YJ11ZpbRV7EoDoLnqgFxe1r68efPI",
    authDomain: "galloners-club.firebaseapp.com",
    projectId: "galloners-club",
    storageBucket: "galloners-club.firebasestorage.app",
    messagingSenderId: "213049860421",
    appId: "1:213049860421:web:4156aaa52b945f48711e2c",
    measurementId: "G-XYXJH9JNXJ"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let serials = [];

window.addSerial = function(){
    let serial = document.getElementById("serialInput").value;
    let date = document.getElementById("dateInput").value;

    if(serial === "" || date === ""){
        alert("Enter serial number and date.");
        return;
    }

    serials.push({ serial: serial, date: date });

    document.getElementById("serialInput").value = "";
    document.getElementById("dateInput").value = "";

    renderSerials();
}

function renderSerials(){
    let container = document.getElementById("serialList");
    container.innerHTML = "";

    serials.forEach((s,i)=>{
        container.innerHTML += `
            <div>
                ${s.serial} - ${s.date}
                <button onclick="removeSerial(${i})">Remove</button>
            </div>
        `;
    });
}

window.removeSerial = function(index){
    serials.splice(index,1);
    renderSerials();
}

window.saveDonor = async function(){

    let donorData = {
        firstName: document.getElementById("firstName").value,
        middleName: document.getElementById("middleName").value,
        surname: document.getElementById("surname").value,
        bloodType: document.getElementById("bloodType").value,
        rhFactor: document.getElementById("rhFactor").value,
        birthday: document.getElementById("birthday").value,
        contact: document.getElementById("contact").value,
        serials: serials,
        createdAt: new Date()
    };

    try {
        await addDoc(collection(db, "donors"), donorData);
        alert("Donor saved to cloud successfully!");
        window.location.href = "tracking.html";
    } catch (error) {
        alert("Error saving donor: " + error);
    }
}

</script>

</body>
</html>
