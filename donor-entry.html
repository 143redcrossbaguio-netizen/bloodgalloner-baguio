<!DOCTYPE html>
<html>
<head>
    <title>Galloners Club - Donor Entry</title>
    <meta charset="UTF-8">
    <style>
        body { margin:0; font-family:Arial; background:#f4f4f4; }
        header { background:#b30000; color:white; padding:15px; text-align:center; }
        .container { max-width:500px; margin:20px auto; background:white; padding:20px; border-radius:10px; box-shadow:0 3px 10px rgba(0,0,0,0.1); }
        input, select { width:100%; padding:8px; margin-bottom:10px; }
        button { padding:8px; margin-top:5px; background:#b30000; color:white; border:none; border-radius:5px; cursor:pointer; }
        .serial-box { margin-top:10px; }
    </style>
</head>
<body>

<header>
    <h2>Donor Entry</h2>
</header>

<div class="container">

<input type="text" id="firstName" placeholder="First Name">
<input type="text" id="middleName" placeholder="Middle Name">
<input type="text" id="surname" placeholder="Surname">

<select id="bloodType">
    <option value="">Blood Type</option>
    <option value="A">A</option>
    <option value="B">B</option>
    <option value="AB">AB</option>
    <option value="O">O</option>
</select>

<select id="rhFactor">
    <option value="">Rh Factor</option>
    <option value="+">+</option>
    <option value="-">-</option>
</select>

<input type="date" id="birthday">
<input type="text" id="contact" placeholder="Contact Number">

<hr>
<h3>Serial Records</h3>
<input type="text" id="serialInput" placeholder="Serial Number">
<input type="date" id="dateInput">
<button onclick="addSerial()">Add Serial</button>
<div id="serialList" class="serial-box"></div>

<hr>
<button onclick="saveDonor()">Save Donor</button>
<button onclick="window.location.href='dashboard.html'">Return to Dashboard</button>
<button onclick="window.location.href='tracking.html'">Go to Tracking</button>

</div>

<script>
let serials = [];

// Add serial
function addSerial() {
    let s = document.getElementById("serialInput").value.trim();
    let d = document.getElementById("dateInput").value;
    if(!s || !d) { alert("Enter serial number and date."); return; }
    serials.push({ serial: s, date: d });
    document.getElementById("serialInput").value = "";
    document.getElementById("dateInput").value = "";
    renderSerials();
}

// Render serials
function renderSerials() {
    let container = document.getElementById("serialList");
    container.innerHTML = "";
    serials.forEach((s,i)=>{
        container.innerHTML += `<div>${s.serial} - ${s.date} <button onclick="removeSerial(${i})">Remove</button></div>`;
    });
}

// Remove serial
function removeSerial(i){ serials.splice(i,1); renderSerials(); }

// Save donor
function saveDonor() {
    let firstName = document.getElementById("firstName").value.trim();
    let middleName = document.getElementById("middleName").value.trim();
    let surname = document.getElementById("surname").value.trim();
    let bloodType = document.getElementById("bloodType").value;
    let rhFactor = document.getElementById("rhFactor").value;
    let birthday = document.getElementById("birthday").value;
    let contact = document.getElementById("contact").value.trim();

    if(!firstName || !surname || !bloodType || !rhFactor){ alert("Fill required fields."); return; }

    let donor = { firstName, middleName, surname, bloodType, rhFactor, birthday, contact, serials };

    // Get existing donors
    let donors = JSON.parse(localStorage.getItem("donors")) || [];
    let editIndex = localStorage.getItem("editIndex");

    // Check duplicates
    let fullName = firstName + " " + middleName + " " + surname;
    if(!editIndex && donors.some(d => (d.firstName+" "+d.middleName+" "+d.surname) === fullName)){
        if(!confirm("Donor exists. Add anyway?")) return;
    }

    if(editIndex !== null){
        donors[editIndex] = donor;
        localStorage.removeItem("editIndex");
    } else {
        donors.push(donor);
    }

    localStorage.setItem("donors", JSON.stringify(donors));
    alert("Donor saved successfully!");
    window.location.href = "tracking.html";
}

// Load donor for editing
window.onload = function(){
    let editIndex = localStorage.getItem("editIndex");
    if(editIndex !== null){
        let donors = JSON.parse(localStorage.getItem("donors")) || [];
        let donor = donors[editIndex];
        document.getElementById("firstName").value = donor.firstName;
        document.getElementById("middleName").value = donor.middleName;
        document.getElementById("surname").value = donor.surname;
        document.getElementById("bloodType").value = donor.bloodType;
        document.getElementById("rhFactor").value = donor.rhFactor;
        document.getElementById("birthday").value = donor.birthday;
        document.getElementById("contact").value = donor.contact;
        serials = donor.serials || [];
        renderSerials();
    }
}
</script>

</body>
</html>
